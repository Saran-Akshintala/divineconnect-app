<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DivineConnect API Demo</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            min-height: 100vh;
        }
        
        .container {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        
        h1 {
            text-align: center;
            color: #4a5568;
            margin-bottom: 10px;
            font-size: 2.5em;
        }
        
        .subtitle {
            text-align: center;
            color: #718096;
            margin-bottom: 40px;
            font-size: 1.2em;
        }
        
        .api-section {
            margin: 30px 0;
            padding: 25px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            background: #f8fafc;
        }
        
        .api-section h3 {
            color: #2d3748;
            margin-bottom: 15px;
            font-size: 1.4em;
        }
        
        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 10px 10px 0;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        button:active {
            transform: translateY(0);
        }
        
        .response {
            background: #1a202c;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 8px;
            margin-top: 15px;
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
            border-left: 4px solid #667eea;
        }
        
        .status {
            padding: 10px 15px;
            border-radius: 5px;
            margin: 10px 0;
            font-weight: bold;
        }
        
        .status.success {
            background: #c6f6d5;
            color: #22543d;
            border-left: 4px solid #38a169;
        }
        
        .status.error {
            background: #fed7d7;
            color: #742a2a;
            border-left: 4px solid #e53e3e;
        }
        
        .status.info {
            background: #bee3f8;
            color: #2a4365;
            border-left: 4px solid #3182ce;
        }
        
        .input-group {
            margin: 15px 0;
        }
        
        .input-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #4a5568;
        }
        
        .input-group input, .input-group textarea {
            width: 100%;
            padding: 10px;
            border: 2px solid #e2e8f0;
            border-radius: 5px;
            font-size: 14px;
            transition: border-color 0.2s;
        }
        
        .input-group input:focus, .input-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        
        .feature-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            border-left: 4px solid #667eea;
        }
        
        .feature-card h4 {
            color: #2d3748;
            margin-bottom: 10px;
        }
        
        .server-status {
            text-align: center;
            margin: 20px 0;
            padding: 15px;
            border-radius: 8px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üïâÔ∏è DivineConnect</h1>
        <p class="subtitle">Spiritual Services Marketplace - API Demo</p>
        
        <div id="serverStatus" class="server-status status info">
            Checking server status...
        </div>
        
        <div class="features">
            <div class="feature-card">
                <h4>üîê Authentication</h4>
                <p>Firebase OTP-based authentication system for secure user login and registration.</p>
            </div>
            <div class="feature-card">
                <h4>üë®‚Äçü¶≥ Poojari Profiles</h4>
                <p>Verified spiritual service providers with detailed profiles, ratings, and availability.</p>
            </div>
            <div class="feature-card">
                <h4>üìÖ Booking System</h4>
                <p>Complete booking management with scheduling, status tracking, and notifications.</p>
            </div>
            <div class="feature-card">
                <h4>üí≥ Payment Integration</h4>
                <p>Secure payment processing with Razorpay integration and transaction management.</p>
            </div>
        </div>
        
        <!-- Authentication Section -->
        <div class="api-section">
            <h3>üîê Authentication APIs</h3>
            <button onclick="testLogin()">Test Login</button>
            <button onclick="testRegister()">Test Register</button>
            <div id="authResponse" class="response" style="display: none;"></div>
        </div>
        
        <!-- Poojaris Section -->
        <div class="api-section">
            <h3>üë®‚Äçü¶≥ Poojari APIs</h3>
            <button onclick="getPoojaris()">Get All Poojaris</button>
            <button onclick="getFeaturedPoojaris()">Get Featured Poojaris</button>
            <button onclick="getPoojariById()">Get Poojari by ID</button>
            <div id="poojariResponse" class="response" style="display: none;"></div>
        </div>
        
        <!-- Bookings Section -->
        <div class="api-section">
            <h3>üìÖ Booking APIs</h3>
            <div class="input-group">
                <label for="serviceType">Service Type:</label>
                <input type="text" id="serviceType" placeholder="e.g., Ganesh Pooja" value="Ganesh Pooja">
            </div>
            <div class="input-group">
                <label for="bookingDate">Booking Date:</label>
                <input type="datetime-local" id="bookingDate">
            </div>
            <button onclick="createBooking()">Create Booking</button>
            <button onclick="getUserBookings()">Get User Bookings</button>
            <div id="bookingResponse" class="response" style="display: none;"></div>
        </div>
        
        <!-- Payments Section -->
        <div class="api-section">
            <h3>üí≥ Payment APIs</h3>
            <div class="input-group">
                <label for="amount">Amount (‚Çπ):</label>
                <input type="number" id="amount" placeholder="1000" value="1000">
            </div>
            <button onclick="createPaymentOrder()">Create Payment Order</button>
            <button onclick="verifyPayment()">Verify Payment (Mock)</button>
            <div id="paymentResponse" class="response" style="display: none;"></div>
        </div>
        
        <!-- Reviews Section -->
        <div class="api-section">
            <h3>‚≠ê Review APIs</h3>
            <div class="input-group">
                <label for="rating">Rating (1-5):</label>
                <input type="number" id="rating" min="1" max="5" value="5">
            </div>
            <div class="input-group">
                <label for="comment">Comment:</label>
                <textarea id="comment" rows="3" placeholder="Great service!">Excellent service! Very professional and knowledgeable Poojari.</textarea>
            </div>
            <button onclick="createReview()">Create Review</button>
            <div id="reviewResponse" class="response" style="display: none;"></div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:5000/api/v1';
        let authToken = null;
        
        // Check server status on load
        window.onload = function() {
            checkServerStatus();
            // Set default booking date to tomorrow
            const tomorrow = new Date();
            tomorrow.setDate(tomorrow.getDate() + 1);
            document.getElementById('bookingDate').value = tomorrow.toISOString().slice(0, 16);
        };
        
        async function checkServerStatus() {
            const statusDiv = document.getElementById('serverStatus');
            try {
                const response = await fetch(`${API_BASE}/health`);
                if (response.ok) {
                    statusDiv.className = 'server-status status success';
                    statusDiv.textContent = '‚úÖ Server is running on http://localhost:5000';
                } else {
                    throw new Error('Server responded with error');
                }
            } catch (error) {
                statusDiv.className = 'server-status status error';
                statusDiv.textContent = '‚ùå Server is not responding. Please start the backend server.';
            }
        }
        
        async function makeRequest(endpoint, method = 'GET', body = null) {
            const options = {
                method,
                headers: {
                    'Content-Type': 'application/json',
                }
            };
            
            if (authToken) {
                options.headers.Authorization = `Bearer ${authToken}`;
            }
            
            if (body) {
                options.body = JSON.stringify(body);
            }
            
            try {
                const response = await fetch(`${API_BASE}${endpoint}`, options);
                const data = await response.json();
                return { success: response.ok, data, status: response.status };
            } catch (error) {
                return { success: false, error: error.message };
            }
        }
        
        function displayResponse(elementId, result) {
            const element = document.getElementById(elementId);
            element.style.display = 'block';
            element.textContent = JSON.stringify(result, null, 2);
        }
        
        // Authentication functions
        async function testLogin() {
            const result = await makeRequest('/auth/login', 'POST', {
                phone: '+919876543210',
                firebaseToken: 'mock-token'
            });
            
            if (result.success && result.data.token) {
                authToken = result.data.token;
            }
            
            displayResponse('authResponse', result);
        }
        
        async function testRegister() {
            const result = await makeRequest('/auth/register', 'POST', {
                name: 'Test User',
                phone: '+919876543210',
                email: 'test@example.com',
                role: 'user',
                firebaseToken: 'mock-token'
            });
            
            displayResponse('authResponse', result);
        }
        
        // Poojari functions
        async function getPoojaris() {
            const result = await makeRequest('/poojaris');
            displayResponse('poojariResponse', result);
        }
        
        async function getFeaturedPoojaris() {
            const result = await makeRequest('/poojaris/featured');
            displayResponse('poojariResponse', result);
        }
        
        async function getPoojariById() {
            const result = await makeRequest('/poojaris/1');
            displayResponse('poojariResponse', result);
        }
        
        // Booking functions
        async function createBooking() {
            const serviceType = document.getElementById('serviceType').value;
            const bookingDate = document.getElementById('bookingDate').value;
            
            const result = await makeRequest('/bookings', 'POST', {
                poojariId: 1,
                serviceType: serviceType,
                scheduledDate: bookingDate,
                duration: 120,
                totalAmount: 1500,
                address: 'Test Address, Mumbai',
                specialRequests: 'Please bring all necessary items'
            });
            
            displayResponse('bookingResponse', result);
        }
        
        async function getUserBookings() {
            const result = await makeRequest('/bookings/user');
            displayResponse('bookingResponse', result);
        }
        
        // Payment functions
        async function createPaymentOrder() {
            const amount = document.getElementById('amount').value;
            
            const result = await makeRequest('/payments/create-order', 'POST', {
                amount: parseInt(amount) * 100, // Convert to paise
                currency: 'INR',
                bookingId: 1
            });
            
            displayResponse('paymentResponse', result);
        }
        
        async function verifyPayment() {
            const result = await makeRequest('/payments/verify', 'POST', {
                razorpay_order_id: 'order_mock_123',
                razorpay_payment_id: 'pay_mock_123',
                razorpay_signature: 'mock_signature'
            });
            
            displayResponse('paymentResponse', result);
        }
        
        // Review functions
        async function createReview() {
            const rating = document.getElementById('rating').value;
            const comment = document.getElementById('comment').value;
            
            const result = await makeRequest('/reviews', 'POST', {
                poojariId: 1,
                bookingId: 1,
                rating: parseInt(rating),
                comment: comment,
                serviceQuality: parseInt(rating),
                punctuality: parseInt(rating),
                behavior: parseInt(rating)
            });
            
            displayResponse('reviewResponse', result);
        }
    </script>
</body>
</html>
